/*jshint unused: true, node: true */
/*jslint unparam: true, node: true */
/*jshint -W117 */ /*jshint -W098 */
'use strict';

var omdb_URL = 'http://www.omdbapi.com/?';
var $searchForm = $('.search-form');
var $searchBar = $('input[name=search]')[0];
var FIREBASE_URL = 'https://eamdb.firebaseio.com/eamdb.json';
var $movieDetails = $('.movie-details');
var $table = $('table');

//function to get firebase data and add to table on page load
$.get(FIREBASE_URL, function (data) {
  if (data === null) {
    $table.hide(); //hides table if firebase is empty
  } else {
    Object.keys(data).forEach(function (id) {
      addTableDetail(data[id], id);
    });
  }
});

//function to retrieve movie JSON file and add to html
$searchForm.on('submit', function () {
  var movie = $searchBar.value;
  var url = omdb_URL + 't=' + movie + '&r=json';
  console.log(url);
  $.get(url, function (data) {
    addMovieDetail(data);
  });
  return false;
});

//function to add JSON data to html
function addMovieDetail(data) {
  var $target = $('.movie-details');

  if (data.Title === undefined) {
    $target.empty();
    $target.append('<h2>Sorry, never heard of it!</h2>');
  } else {
    var poster = data.Poster === 'N/A' ? 'http://i.imgur.com/rXuQiCm.jpg?1' : data.Poster;
    $target.empty();
    $target.append('<img src=' + poster + '></img>');
    $target.append('<h1>' + data.Title + '</h1>');
    $target.append('<h2> Year: ' + data.Year + '</h2>');
    $target.append('<h2> IMDB Rating: ' + data.imdbRating + '</h2>');

    $target.append('<button class=\'btn btn-default btn-xs add-movie\'>Add Movie</button>');
  }
}

//posts movie object to firebase and calls addTableDetail()
$movieDetails.on('click', '.add-movie', function () {
  //note: must be in this format because the .add-movie button is dynamically created
  var movie = $searchBar.value;
  var url = omdb_URL + 't=' + movie + '&r=json';
  $.get(url, function (data) {
    $.post(FIREBASE_URL, JSON.stringify(data), function (res) {
      addTableDetail(data, res.name);
    });
  }, 'jsonp');
});

//function to append a row to the table
function addTableDetail(data, id) {
  $table.show();
  $table.append('<tr class=\'hide-rows\'></tr>');
  var $target = $('tr:last');
  $target.attr('data-id', id);
  var poster = data.Poster === 'N/A' ? 'http://i.imgur.com/rXuQiCm.jpg?1' : data.Poster;
  $target.append('<td class="poster"><img src=' + poster + '></img></td>');
  $target.append('<td class="title">' + data.Title + '</td>');
  $target.append('<td class="year">' + data.Year + '</td>');
  $target.append('<td class="rating">' + data.imdbRating + '</td>');
  $target.append('<td><button class=\'btn btn-default btn-xs\'>' + '&nbsp;X&nbsp;' + '</button></td>');
}

//deletes row from table and firebase
$table.on('click', 'button', function () {
  var $movie = $(this).closest('tr');
  var $id = $movie.attr('data-id');
  $movie.remove();
  var deleteURL = FIREBASE_URL.slice(0, -5) + '/' + $id + '.json';
  $.ajax({
    url: deleteURL,
    type: 'DELETE'
  });
});
//# sourceMappingURL=data:application/json;base64,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ckMsTUFBSSxNQUFNLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNuQyxNQUFJLEdBQUcsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ2pDLFFBQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUNoQixNQUFJLFNBQVMsR0FBRyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsT0FBTyxDQUFDO0FBQ2hFLEdBQUMsQ0FBQyxJQUFJLENBQUM7QUFDUCxPQUFHLEVBQUUsU0FBUztBQUNkLFFBQUksRUFBRSxRQUFRO0dBQ2IsQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKmpzaGludCB1bnVzZWQ6IHRydWUsIG5vZGU6IHRydWUgKi9cbi8qanNsaW50IHVucGFyYW06IHRydWUsIG5vZGU6IHRydWUgKi9cbi8qanNoaW50IC1XMTE3ICovIC8qanNoaW50IC1XMDk4ICovXG52YXIgb21kYl9VUkwgPSAnaHR0cDovL3d3dy5vbWRiYXBpLmNvbS8/JztcbnZhciAkc2VhcmNoRm9ybSA9ICQoJy5zZWFyY2gtZm9ybScpO1xudmFyICRzZWFyY2hCYXIgPSAkKCdpbnB1dFtuYW1lPXNlYXJjaF0nKVswXTtcbnZhciBGSVJFQkFTRV9VUkwgPSBcImh0dHBzOi8vZWFtZGIuZmlyZWJhc2Vpby5jb20vZWFtZGIuanNvblwiO1xudmFyICRtb3ZpZURldGFpbHMgPSAkKFwiLm1vdmllLWRldGFpbHNcIik7XG52YXIgJHRhYmxlID0gJChcInRhYmxlXCIpO1xuXG4vL2Z1bmN0aW9uIHRvIGdldCBmaXJlYmFzZSBkYXRhIGFuZCBhZGQgdG8gdGFibGUgb24gcGFnZSBsb2FkXG4kLmdldChGSVJFQkFTRV9VUkwsIGZ1bmN0aW9uKGRhdGEpe1xuICAgIGlmIChkYXRhPT09bnVsbCl7XG4gICAgJHRhYmxlLmhpZGUoKTsgLy9oaWRlcyB0YWJsZSBpZiBmaXJlYmFzZSBpcyBlbXB0eVxuICB9ZWxzZXtcbiAgICBPYmplY3Qua2V5cyhkYXRhKS5mb3JFYWNoKGZ1bmN0aW9uKGlkKXtcbiAgICAgIGFkZFRhYmxlRGV0YWlsKGRhdGFbaWRdLCBpZCk7XG4gICAgfSk7XG4gIH1cbn0pO1xuXG5cbi8vZnVuY3Rpb24gdG8gcmV0cmlldmUgbW92aWUgSlNPTiBmaWxlIGFuZCBhZGQgdG8gaHRtbFxuJHNlYXJjaEZvcm0ub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uKCl7XG4gIHZhciBtb3ZpZSA9ICRzZWFyY2hCYXIudmFsdWU7XG4gIHZhciB1cmwgPSBvbWRiX1VSTCArIFwidD1cIiArIG1vdmllICsgXCImcj1qc29uXCI7XG4gIGNvbnNvbGUubG9nKHVybCk7XG4gICQuZ2V0KHVybCwgZnVuY3Rpb24oZGF0YSl7XG4gICAgYWRkTW92aWVEZXRhaWwoZGF0YSk7XG4gIH0pO1xuICByZXR1cm4gZmFsc2U7XG59KTtcblxuXG4vL2Z1bmN0aW9uIHRvIGFkZCBKU09OIGRhdGEgdG8gaHRtbFxuZnVuY3Rpb24gYWRkTW92aWVEZXRhaWwoZGF0YSl7XG4gIHZhciAkdGFyZ2V0ID0gJChcIi5tb3ZpZS1kZXRhaWxzXCIpO1xuXG4gIGlmIChkYXRhLlRpdGxlID09PSB1bmRlZmluZWQpIHtcbiAgICAkdGFyZ2V0LmVtcHR5KCk7XG4gICAgJHRhcmdldC5hcHBlbmQoXCI8aDI+U29ycnksIG5ldmVyIGhlYXJkIG9mIGl0ITwvaDI+XCIpO1xuICB9IGVsc2Uge1xuICAgIHZhciBwb3N0ZXIgPSBkYXRhLlBvc3RlciA9PT0gXCJOL0FcIiA/IFwiaHR0cDovL2kuaW1ndXIuY29tL3JYdVFpQ20uanBnPzFcIiA6IGRhdGEuUG9zdGVyO1xuICAgICR0YXJnZXQuZW1wdHkoKTtcbiAgICAkdGFyZ2V0LmFwcGVuZChcIjxpbWcgc3JjPVwiICsgcG9zdGVyICsgXCI+PC9pbWc+XCIpO1xuICAgICR0YXJnZXQuYXBwZW5kKFwiPGgxPlwiICsgZGF0YS5UaXRsZSArIFwiPC9oMT5cIik7XG4gICAgJHRhcmdldC5hcHBlbmQoXCI8aDI+IFllYXI6IFwiICsgZGF0YS5ZZWFyICsgXCI8L2gyPlwiKTtcbiAgICAkdGFyZ2V0LmFwcGVuZChcIjxoMj4gSU1EQiBSYXRpbmc6IFwiICsgZGF0YS5pbWRiUmF0aW5nICsgXCI8L2gyPlwiKTtcblxuICAgICR0YXJnZXQuYXBwZW5kKFwiPGJ1dHRvbiBjbGFzcz0nYnRuIGJ0bi1kZWZhdWx0IGJ0bi14cyBhZGQtbW92aWUnPkFkZCBNb3ZpZTwvYnV0dG9uPlwiKTtcbiAgICB9XG59XG5cbi8vcG9zdHMgbW92aWUgb2JqZWN0IHRvIGZpcmViYXNlIGFuZCBjYWxscyBhZGRUYWJsZURldGFpbCgpXG4kbW92aWVEZXRhaWxzLm9uKCdjbGljaycsICcuYWRkLW1vdmllJywgZnVuY3Rpb24oKSB7XG4gIC8vbm90ZTogbXVzdCBiZSBpbiB0aGlzIGZvcm1hdCBiZWNhdXNlIHRoZSAuYWRkLW1vdmllIGJ1dHRvbiBpcyBkeW5hbWljYWxseSBjcmVhdGVkXG4gIHZhciBtb3ZpZSA9ICRzZWFyY2hCYXIudmFsdWU7XG4gIHZhciB1cmwgPSBvbWRiX1VSTCArIFwidD1cIiArIG1vdmllICsgXCImcj1qc29uXCI7XG4gICQuZ2V0KHVybCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAkLnBvc3QoRklSRUJBU0VfVVJMLCBKU09OLnN0cmluZ2lmeShkYXRhKSwgZnVuY3Rpb24ocmVzKXtcbiAgICAgIGFkZFRhYmxlRGV0YWlsKGRhdGEsIHJlcy5uYW1lKTtcbiAgICAgIH0pO1xuICAgIH0sICdqc29ucCcpO1xuIH0pO1xuXG4vL2Z1bmN0aW9uIHRvIGFwcGVuZCBhIHJvdyB0byB0aGUgdGFibGVcbmZ1bmN0aW9uIGFkZFRhYmxlRGV0YWlsKGRhdGEsIGlkKXtcbiAgJHRhYmxlLnNob3coKTtcbiAgJHRhYmxlLmFwcGVuZChcIjx0ciBjbGFzcz0naGlkZS1yb3dzJz48L3RyPlwiKTtcbiAgdmFyICR0YXJnZXQgPSAkKFwidHI6bGFzdFwiKTtcbiAgJHRhcmdldC5hdHRyKFwiZGF0YS1pZFwiLCBpZCk7XG4gIHZhciBwb3N0ZXIgPSBkYXRhLlBvc3RlciA9PT0gXCJOL0FcIiA/IFwiaHR0cDovL2kuaW1ndXIuY29tL3JYdVFpQ20uanBnPzFcIiA6IGRhdGEuUG9zdGVyO1xuICAkdGFyZ2V0LmFwcGVuZChcIjx0ZCBjbGFzcz1cXFwicG9zdGVyXFxcIj48aW1nIHNyYz1cIiArIHBvc3RlciArIFwiPjwvaW1nPjwvdGQ+XCIpO1xuICAkdGFyZ2V0LmFwcGVuZChcIjx0ZCBjbGFzcz1cXFwidGl0bGVcXFwiPlwiKyBkYXRhLlRpdGxlICtcIjwvdGQ+XCIpO1xuICAkdGFyZ2V0LmFwcGVuZChcIjx0ZCBjbGFzcz1cXFwieWVhclxcXCI+XCIrIGRhdGEuWWVhciArXCI8L3RkPlwiKTtcbiAgJHRhcmdldC5hcHBlbmQoXCI8dGQgY2xhc3M9XFxcInJhdGluZ1xcXCI+XCIrIGRhdGEuaW1kYlJhdGluZyArXCI8L3RkPlwiKTtcbiAgJHRhcmdldC5hcHBlbmQoXCI8dGQ+PGJ1dHRvbiBjbGFzcz0nYnRuIGJ0bi1kZWZhdWx0IGJ0bi14cyc+XCIrIFwiJm5ic3A7WCZuYnNwO1wiICtcIjwvYnV0dG9uPjwvdGQ+XCIpO1xufVxuXG5cbi8vZGVsZXRlcyByb3cgZnJvbSB0YWJsZSBhbmQgZmlyZWJhc2VcbiR0YWJsZS5vbignY2xpY2snLCAnYnV0dG9uJywgZnVuY3Rpb24oKXtcbiAgdmFyICRtb3ZpZSA9ICQodGhpcykuY2xvc2VzdCgndHInKTtcbiAgdmFyICRpZCA9ICRtb3ZpZS5hdHRyKCdkYXRhLWlkJyk7XG4gICRtb3ZpZS5yZW1vdmUoKTtcbiAgdmFyIGRlbGV0ZVVSTCA9IEZJUkVCQVNFX1VSTC5zbGljZSgwLCAtNSkgKyAnLycgKyAkaWQgKyAnLmpzb24nO1xuICAkLmFqYXgoe1xuICB1cmw6IGRlbGV0ZVVSTCxcbiAgdHlwZTogJ0RFTEVURSdcbiAgfSk7XG59KTtcblxuXG4iXX0=
