/*jshint unused: true, node: true */
/*jslint unparam: true, node: true */
/*jshint -W117 */ /*jshint -W098 */
'use strict';

var omdb_URL = 'http://www.omdbapi.com/?';
var $searchForm = $('.search-form');
var $searchBar = $('input[name=search]')[0];
//var FIREBASE_URL = "https://eamdb.firebaseio.com/eamdb.json";
var $movieDetails = $('.movie-details');
var $table = $('table');

//function to get firebase data and add to table on page load
$.get(FIREBASE_URL, function (data) {
  if (data === null) {
    $table.hide(); //hides table if firebase is empty
  } else {
    Object.keys(data).forEach(function (id) {
      addTableDetail(data[id], id);
    });
  }
});

//function to retrieve movie JSON file and add to html
$searchForm.on('submit', function () {
  var movie = $searchBar.value;
  var url = omdb_URL + 't=' + movie + '&r=json';
  console.log(url);
  $.get(url, function (data) {
    addMovieDetail(data);
  });
  return false;
});

//function to add JSON data to html
function addMovieDetail(data) {
  var $target = $('.movie-details');

  if (data.Title === undefined) {
    $target.empty();
    $target.append('<h2>Sorry, never heard of it!</h2>');
  } else {
    var poster = data.Poster === 'N/A' ? 'http://i.imgur.com/rXuQiCm.jpg?1' : data.Poster;
    $target.empty();
    $target.append('<img src=' + poster + '></img>');
    $target.append('<h1>' + data.Title + '</h1>');
    $target.append('<h2> Year: ' + data.Year + '</h2>');
    $target.append('<h2> IMDB Rating: ' + data.imdbRating + '</h2>');

    $target.append('<button class=\'btn btn-default btn-xs add-movie\'>Add Movie</button>');
  }
}

//posts movie object to firebase and calls addTableDetail()
$movieDetails.on('click', '.add-movie', function () {
  //note: must be in this format because the .add-movie button is dynamically created
  var movie = $searchBar.value;
  var url = omdb_URL + 't=' + movie + '&r=json';
  $.get(url, function (data) {
    $.post(FIREBASE_URL, JSON.stringify(data), function (res) {
      addTableDetail(data, res.name);
    });
  }, 'jsonp');
});

//function to append a row to the table
function addTableDetail(data, id) {
  $table.show();
  $table.append('<tr class=\'hide-rows\'></tr>');
  var $target = $('tr:last');
  $target.attr('data-id', id);
  var poster = data.Poster === 'N/A' ? 'http://i.imgur.com/rXuQiCm.jpg?1' : data.Poster;
  $target.append('<td class="poster"><img src=' + poster + '></img></td>');
  $target.append('<td class="title">' + data.Title + '</td>');
  $target.append('<td class="year">' + data.Year + '</td>');
  $target.append('<td class="rating">' + data.imdbRating + '</td>');
  $target.append('<td><button class=\'btn btn-default btn-xs\'>' + '&nbsp;X&nbsp;' + '</button></td>');
}

//deletes row from table and firebase
$table.on('click', 'button', function () {
  var $movie = $(this).closest('tr');
  var $id = $movie.attr('data-id');
  $movie.remove();
  var deleteURL = FIREBASE_URL.slice(0, -5) + '/' + $id + '.json';
  $.ajax({
    url: deleteURL,
    type: 'DELETE'
  });
});
//# sourceMappingURL=data:application/json;base64,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LENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDbkMsTUFBSSxHQUFHLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUNqQyxRQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDaEIsTUFBSSxTQUFTLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLE9BQU8sQ0FBQztBQUNoRSxHQUFDLENBQUMsSUFBSSxDQUFDO0FBQ1AsT0FBRyxFQUFFLFNBQVM7QUFDZCxRQUFJLEVBQUUsUUFBUTtHQUNiLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypqc2hpbnQgdW51c2VkOiB0cnVlLCBub2RlOiB0cnVlICovXG4vKmpzbGludCB1bnBhcmFtOiB0cnVlLCBub2RlOiB0cnVlICovXG4vKmpzaGludCAtVzExNyAqLyAvKmpzaGludCAtVzA5OCAqL1xudmFyIG9tZGJfVVJMID0gJ2h0dHA6Ly93d3cub21kYmFwaS5jb20vPyc7XG52YXIgJHNlYXJjaEZvcm0gPSAkKCcuc2VhcmNoLWZvcm0nKTtcbnZhciAkc2VhcmNoQmFyID0gJCgnaW5wdXRbbmFtZT1zZWFyY2hdJylbMF07XG4vL3ZhciBGSVJFQkFTRV9VUkwgPSBcImh0dHBzOi8vZWFtZGIuZmlyZWJhc2Vpby5jb20vZWFtZGIuanNvblwiO1xudmFyICRtb3ZpZURldGFpbHMgPSAkKFwiLm1vdmllLWRldGFpbHNcIik7XG52YXIgJHRhYmxlID0gJChcInRhYmxlXCIpO1xuXG4vL2Z1bmN0aW9uIHRvIGdldCBmaXJlYmFzZSBkYXRhIGFuZCBhZGQgdG8gdGFibGUgb24gcGFnZSBsb2FkXG4kLmdldChGSVJFQkFTRV9VUkwsIGZ1bmN0aW9uKGRhdGEpe1xuICAgIGlmIChkYXRhPT09bnVsbCl7XG4gICAgJHRhYmxlLmhpZGUoKTsgLy9oaWRlcyB0YWJsZSBpZiBmaXJlYmFzZSBpcyBlbXB0eVxuICB9ZWxzZXtcbiAgICBPYmplY3Qua2V5cyhkYXRhKS5mb3JFYWNoKGZ1bmN0aW9uKGlkKXtcbiAgICAgIGFkZFRhYmxlRGV0YWlsKGRhdGFbaWRdLCBpZCk7XG4gICAgfSk7XG4gIH1cbn0pO1xuXG5cbi8vZnVuY3Rpb24gdG8gcmV0cmlldmUgbW92aWUgSlNPTiBmaWxlIGFuZCBhZGQgdG8gaHRtbFxuJHNlYXJjaEZvcm0ub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uKCl7XG4gIHZhciBtb3ZpZSA9ICRzZWFyY2hCYXIudmFsdWU7XG4gIHZhciB1cmwgPSBvbWRiX1VSTCArIFwidD1cIiArIG1vdmllICsgXCImcj1qc29uXCI7XG4gIGNvbnNvbGUubG9nKHVybCk7XG4gICQuZ2V0KHVybCwgZnVuY3Rpb24oZGF0YSl7XG4gICAgYWRkTW92aWVEZXRhaWwoZGF0YSk7XG4gIH0pO1xuICByZXR1cm4gZmFsc2U7XG59KTtcblxuXG4vL2Z1bmN0aW9uIHRvIGFkZCBKU09OIGRhdGEgdG8gaHRtbFxuZnVuY3Rpb24gYWRkTW92aWVEZXRhaWwoZGF0YSl7XG4gIHZhciAkdGFyZ2V0ID0gJChcIi5tb3ZpZS1kZXRhaWxzXCIpO1xuXG4gIGlmIChkYXRhLlRpdGxlID09PSB1bmRlZmluZWQpIHtcbiAgICAkdGFyZ2V0LmVtcHR5KCk7XG4gICAgJHRhcmdldC5hcHBlbmQoXCI8aDI+U29ycnksIG5ldmVyIGhlYXJkIG9mIGl0ITwvaDI+XCIpO1xuICB9IGVsc2Uge1xuICAgIHZhciBwb3N0ZXIgPSBkYXRhLlBvc3RlciA9PT0gXCJOL0FcIiA/IFwiaHR0cDovL2kuaW1ndXIuY29tL3JYdVFpQ20uanBnPzFcIiA6IGRhdGEuUG9zdGVyO1xuICAgICR0YXJnZXQuZW1wdHkoKTtcbiAgICAkdGFyZ2V0LmFwcGVuZChcIjxpbWcgc3JjPVwiICsgcG9zdGVyICsgXCI+PC9pbWc+XCIpO1xuICAgICR0YXJnZXQuYXBwZW5kKFwiPGgxPlwiICsgZGF0YS5UaXRsZSArIFwiPC9oMT5cIik7XG4gICAgJHRhcmdldC5hcHBlbmQoXCI8aDI+IFllYXI6IFwiICsgZGF0YS5ZZWFyICsgXCI8L2gyPlwiKTtcbiAgICAkdGFyZ2V0LmFwcGVuZChcIjxoMj4gSU1EQiBSYXRpbmc6IFwiICsgZGF0YS5pbWRiUmF0aW5nICsgXCI8L2gyPlwiKTtcblxuICAgICR0YXJnZXQuYXBwZW5kKFwiPGJ1dHRvbiBjbGFzcz0nYnRuIGJ0bi1kZWZhdWx0IGJ0bi14cyBhZGQtbW92aWUnPkFkZCBNb3ZpZTwvYnV0dG9uPlwiKTtcbiAgICB9XG59XG5cbi8vcG9zdHMgbW92aWUgb2JqZWN0IHRvIGZpcmViYXNlIGFuZCBjYWxscyBhZGRUYWJsZURldGFpbCgpXG4kbW92aWVEZXRhaWxzLm9uKCdjbGljaycsICcuYWRkLW1vdmllJywgZnVuY3Rpb24oKSB7XG4gIC8vbm90ZTogbXVzdCBiZSBpbiB0aGlzIGZvcm1hdCBiZWNhdXNlIHRoZSAuYWRkLW1vdmllIGJ1dHRvbiBpcyBkeW5hbWljYWxseSBjcmVhdGVkXG4gIHZhciBtb3ZpZSA9ICRzZWFyY2hCYXIudmFsdWU7XG4gIHZhciB1cmwgPSBvbWRiX1VSTCArIFwidD1cIiArIG1vdmllICsgXCImcj1qc29uXCI7XG4gICQuZ2V0KHVybCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAkLnBvc3QoRklSRUJBU0VfVVJMLCBKU09OLnN0cmluZ2lmeShkYXRhKSwgZnVuY3Rpb24ocmVzKXtcbiAgICAgIGFkZFRhYmxlRGV0YWlsKGRhdGEsIHJlcy5uYW1lKTtcbiAgICAgIH0pO1xuICAgIH0sICdqc29ucCcpO1xuIH0pO1xuXG4vL2Z1bmN0aW9uIHRvIGFwcGVuZCBhIHJvdyB0byB0aGUgdGFibGVcbmZ1bmN0aW9uIGFkZFRhYmxlRGV0YWlsKGRhdGEsIGlkKXtcbiAgJHRhYmxlLnNob3coKTtcbiAgJHRhYmxlLmFwcGVuZChcIjx0ciBjbGFzcz0naGlkZS1yb3dzJz48L3RyPlwiKTtcbiAgdmFyICR0YXJnZXQgPSAkKFwidHI6bGFzdFwiKTtcbiAgJHRhcmdldC5hdHRyKFwiZGF0YS1pZFwiLCBpZCk7XG4gIHZhciBwb3N0ZXIgPSBkYXRhLlBvc3RlciA9PT0gXCJOL0FcIiA/IFwiaHR0cDovL2kuaW1ndXIuY29tL3JYdVFpQ20uanBnPzFcIiA6IGRhdGEuUG9zdGVyO1xuICAkdGFyZ2V0LmFwcGVuZChcIjx0ZCBjbGFzcz1cXFwicG9zdGVyXFxcIj48aW1nIHNyYz1cIiArIHBvc3RlciArIFwiPjwvaW1nPjwvdGQ+XCIpO1xuICAkdGFyZ2V0LmFwcGVuZChcIjx0ZCBjbGFzcz1cXFwidGl0bGVcXFwiPlwiKyBkYXRhLlRpdGxlICtcIjwvdGQ+XCIpO1xuICAkdGFyZ2V0LmFwcGVuZChcIjx0ZCBjbGFzcz1cXFwieWVhclxcXCI+XCIrIGRhdGEuWWVhciArXCI8L3RkPlwiKTtcbiAgJHRhcmdldC5hcHBlbmQoXCI8dGQgY2xhc3M9XFxcInJhdGluZ1xcXCI+XCIrIGRhdGEuaW1kYlJhdGluZyArXCI8L3RkPlwiKTtcbiAgJHRhcmdldC5hcHBlbmQoXCI8dGQ+PGJ1dHRvbiBjbGFzcz0nYnRuIGJ0bi1kZWZhdWx0IGJ0bi14cyc+XCIrIFwiJm5ic3A7WCZuYnNwO1wiICtcIjwvYnV0dG9uPjwvdGQ+XCIpO1xufVxuXG5cbi8vZGVsZXRlcyByb3cgZnJvbSB0YWJsZSBhbmQgZmlyZWJhc2VcbiR0YWJsZS5vbignY2xpY2snLCAnYnV0dG9uJywgZnVuY3Rpb24oKXtcbiAgdmFyICRtb3ZpZSA9ICQodGhpcykuY2xvc2VzdCgndHInKTtcbiAgdmFyICRpZCA9ICRtb3ZpZS5hdHRyKCdkYXRhLWlkJyk7XG4gICRtb3ZpZS5yZW1vdmUoKTtcbiAgdmFyIGRlbGV0ZVVSTCA9IEZJUkVCQVNFX1VSTC5zbGljZSgwLCAtNSkgKyAnLycgKyAkaWQgKyAnLmpzb24nO1xuICAkLmFqYXgoe1xuICB1cmw6IGRlbGV0ZVVSTCxcbiAgdHlwZTogJ0RFTEVURSdcbiAgfSk7XG59KTtcblxuXG4iXX0=
